---
title: "Tablero de indicadores regionales"
author: "José Gonzalez Rearte"
date: "14/02/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Objetivo

El objetivo del presente trabajo es realizar un _tablero web_ con las principales tasas de la EPH a nivel aglomerado, provincia y región.


## Tasas seleccionadas

En una primera etapa se calcuarán las tasa de empleo, de desocupación y de actividadpor aglomerado y agregadas por provincia y por región.

- Tasa de actividad:  $\frac{PEA}{Población}$ 
- Tasa de empleo:  $\frac{Ocupados}{Población}$ 
- Tasa de desocupación:  $\frac{Desocupados}{PEA}$ 

## Descripción del proceso de carga de las variables de la EPH

```{r variables EPH, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(tidyverse)
library(eph) #no lo puedo usar desde la PC del trabajo
library(openxlsx) #como no me descarga las bases con el paquete, 
                  #las bajo y las abro con el excel
library(readxl)

#Sin notacion cientifica
options(scipen = 999)
options(OutDec= ",") #Decimales
options(digits = 2) #Decimales

# Funcion de redondeo para presentación (queda como character)
formato_porc <- function(numero, dec = 1){
  format(round(numero, digits = dec), nsmall = dec, decimal.mark = ",")
}

formato_pesos <- function(numero, dec = 2){
  paste0("$", format(round(numero, digits = dec), nsmall = dec, big.mark = ".", decimal.mark = ","))
}

formato_cantidad <- function(numero, dec = 0){
  format(round(numero, digits = dec), nsmall = dec, big.mark = ".", decimal.mark = ",")
}


regiones <- read_xlsx("REGIONES.xlsx") #usamos nuestra definición de regiones 
Aglom <- read.xlsx("Aglomerados EPH.xlsx")
provincias <- read.xlsx("PROVINCIAS.xlsx")
periodo <- c("2T 2019", "1T 2019", "4T 2018", "3T 2018", "2T 2018", 
             "1T 2018","4T 2017","3T 2017", "2T 2017", "1T 2017", 
             "4T 2016", "3T 2016", "2T 2016")
regiones
# Individual_t219 <- get_microdata(2019, trimester = 2, type = "individual")

Individual_t219 <- read.table("Base individual/USU_individual_t219.txt",
                                sep = ";",
                                dec = ",",
                                header = TRUE,
                                fill = TRUE ) %>% 
                   select(AGLOMERADO, PONDERA, ESTADO, CAT_OCUP, PP04A,
                          PP04B_COD) %>% 
                   rename(priv.pub = PP04A, 
                          codigo.actividad = PP04B_COD) %>% 
                   mutate(ESTADO = case_when(ESTADO == 0 ~ "Sin resp",
                                             ESTADO == 1 ~ "Ocupados",
                                             ESTADO == 2 ~ "Desocupados",
                                             ESTADO == 3 ~ "Inactivos",
                                             ESTADO == 4 ~ "Menor"), 
                          CAT_OCUP = case_when(CAT_OCUP == 1 ~ "Patrón",
                                               CAT_OCUP == 2 ~ "Cuenta propia",
                                               CAT_OCUP == 3 ~ "Empleado",
                                               CAT_OCUP == 4 ~ "Familiar",
                                               CAT_OCUP == 9 ~ "NS.NR"),
                          priv.pub = case_when(priv.pub == 1 ~ "Estatal",
                                               priv.pub == 2 ~ "Privado",
                                               priv.pub == 3 ~ "Otro")) %>% 
                    left_join(., provincias) %>%
                    left_join(., regiones) %>%  
                    left_join(.,Aglom) %>%
                    select(-AGLOMERADO) 
                   
                            

Individual_t119 <- read.table("Base individual/USU_individual_t119.txt",
                                sep = ";",
                                dec = ",",
                                header = TRUE,
                                fill = TRUE ) %>% 
                   select(AGLOMERADO, PONDERA, ESTADO, CAT_OCUP, PP04A,
                          PP04B_COD) %>% 
                   rename(priv.pub = PP04A, codigo.actividad = PP04B_COD) %>% 
                   mutate(ESTADO = case_when(ESTADO == 0 ~ "Sin resp",
                                             ESTADO == 1 ~ "Ocupados",
                                             ESTADO == 2 ~ "Desocupados",
                                             ESTADO == 3 ~ "Inactivos",
                                             ESTADO == 4 ~ "Menor"), 
                          CAT_OCUP = case_when(CAT_OCUP == 1 ~ "Patrón",
                                               CAT_OCUP == 2 ~ "Cuenta propia",
                                               CAT_OCUP == 3 ~ "Empleado",
                                               CAT_OCUP == 4 ~ "Familiar",
                                               CAT_OCUP == 9 ~ "NS.NR"),
                          priv.pub = case_when(priv.pub == 1 ~ "Estatal",
                                               priv.pub == 2 ~ "Privado",
                                               priv.pub == 3 ~ "Otro")) %>% 
                    left_join(., provincias) %>%
                    left_join(., regiones) %>%  
                    left_join(.,Aglom) %>%
                    select(-AGLOMERADO)

Individual_t418 <- read.table("Base individual/USU_individual_t418.txt",
                                sep = ";",
                                dec = ",",
                                header = TRUE,
                                fill = TRUE ) %>% 
                   select(AGLOMERADO, PONDERA, ESTADO, CAT_OCUP, PP04A,
                          PP04B_COD) %>% 
                   rename(priv.pub = PP04A, codigo.actividad = PP04B_COD) %>% 
                   mutate(ESTADO = case_when(ESTADO == 0 ~ "Sin resp",
                                             ESTADO == 1 ~ "Ocupados",
                                             ESTADO == 2 ~ "Desocupados",
                                             ESTADO == 3 ~ "Inactivos",
                                             ESTADO == 4 ~ "Menor"), 
                          CAT_OCUP = case_when(CAT_OCUP == 1 ~ "Patrón",
                                               CAT_OCUP == 2 ~ "Cuenta propia",
                                               CAT_OCUP == 3 ~ "Empleado",
                                               CAT_OCUP == 4 ~ "Familiar",
                                               CAT_OCUP == 9 ~ "NS.NR"),
                          priv.pub = case_when(priv.pub == 1 ~ "Estatal",
                                               priv.pub == 2 ~ "Privado",
                                               priv.pub == 3 ~ "Otro")) %>% 
                    left_join(., provincias) %>%
                    left_join(., regiones) %>%  
                    left_join(.,Aglom) %>%
                    select(-AGLOMERADO)

Individual_t318 <- read.table("Base individual/USU_individual_t318.txt",
                                sep = ";",
                                dec = ",",
                                header = TRUE,
                                fill = TRUE ) %>% 
                   select(AGLOMERADO, PONDERA, ESTADO, CAT_OCUP, PP04A,
                          PP04B_COD) %>% 
                   rename(priv.pub = PP04A, codigo.actividad = PP04B_COD) %>% 
                   mutate(ESTADO = case_when(ESTADO == 0 ~ "Sin resp",
                                             ESTADO == 1 ~ "Ocupados",
                                             ESTADO == 2 ~ "Desocupados",
                                             ESTADO == 3 ~ "Inactivos",
                                             ESTADO == 4 ~ "Menor"), 
                          CAT_OCUP = case_when(CAT_OCUP == 1 ~ "Patrón",
                                               CAT_OCUP == 2 ~ "Cuenta propia",
                                               CAT_OCUP == 3 ~ "Empleado",
                                               CAT_OCUP == 4 ~ "Familiar",
                                               CAT_OCUP == 9 ~ "NS.NR"),
                          priv.pub = case_when(priv.pub == 1 ~ "Estatal",
                                               priv.pub == 2 ~ "Privado",
                                               priv.pub == 3 ~ "Otro")) %>% 
                    left_join(., provincias) %>%
                    left_join(., regiones) %>%  
                    left_join(.,Aglom) %>%
                    select(-AGLOMERADO)

Individual_t218 <- read.table("Base individual/USU_individual_t218.txt",
                                sep = ";",
                                dec = ",",
                                header = TRUE,
                                fill = TRUE ) %>% 
                   select(AGLOMERADO, PONDERA, ESTADO, CAT_OCUP, PP04A,
                          PP04B_COD) %>% 
                   rename(priv.pub = PP04A, codigo.actividad = PP04B_COD) %>% 
                   mutate(ESTADO = case_when(ESTADO == 0 ~ "Sin resp",
                                             ESTADO == 1 ~ "Ocupados",
                                             ESTADO == 2 ~ "Desocupados",
                                             ESTADO == 3 ~ "Inactivos",
                                             ESTADO == 4 ~ "Menor"), 
                          CAT_OCUP = case_when(CAT_OCUP == 1 ~ "Patrón",
                                               CAT_OCUP == 2 ~ "Cuenta propia",
                                               CAT_OCUP == 3 ~ "Empleado",
                                               CAT_OCUP == 4 ~ "Familiar",
                                               CAT_OCUP == 9 ~ "NS.NR"),
                          priv.pub = case_when(priv.pub == 1 ~ "Estatal",
                                               priv.pub == 2 ~ "Privado",
                                               priv.pub == 3 ~ "Otro")) %>% 
                    left_join(., provincias) %>%
                    left_join(., regiones) %>%  
                    left_join(.,Aglom) %>%
                    select(-AGLOMERADO)


Individual_t118 <- read.table("Base individual/USU_individual_t118.txt",
                                sep = ";",
                                dec = ",",
                                header = TRUE,
                                fill = TRUE ) %>% 
                   select(AGLOMERADO, PONDERA, ESTADO, CAT_OCUP, PP04A,
                          PP04B_COD) %>% 
                   rename(priv.pub = PP04A, codigo.actividad = PP04B_COD) %>% 
                   mutate(ESTADO = case_when(ESTADO == 0 ~ "Sin resp",
                                             ESTADO == 1 ~ "Ocupados",
                                             ESTADO == 2 ~ "Desocupados",
                                             ESTADO == 3 ~ "Inactivos",
                                             ESTADO == 4 ~ "Menor"), 
                          CAT_OCUP = case_when(CAT_OCUP == 1 ~ "Patrón",
                                               CAT_OCUP == 2 ~ "Cuenta propia",
                                               CAT_OCUP == 3 ~ "Empleado",
                                               CAT_OCUP == 4 ~ "Familiar",
                                               CAT_OCUP == 9 ~ "NS.NR"),
                          priv.pub = case_when(priv.pub == 1 ~ "Estatal",
                                               priv.pub == 2 ~ "Privado",
                                               priv.pub == 3 ~ "Otro")) %>% 
                    left_join(., provincias) %>%
                    left_join(., regiones) %>%  
                    left_join(.,Aglom) %>%
                    select(-AGLOMERADO)

Individual_t417 <- read.table("Base individual/USU_individual_t417.txt",
                                sep = ";",
                                dec = ",",
                                header = TRUE,
                                fill = TRUE ) %>% 
                   select(AGLOMERADO, PONDERA, ESTADO, CAT_OCUP, PP04A,
                          PP04B_COD) %>% 
                   rename(priv.pub = PP04A, codigo.actividad = PP04B_COD) %>% 
                   mutate(ESTADO = case_when(ESTADO == 0 ~ "Sin resp",
                                             ESTADO == 1 ~ "Ocupados",
                                             ESTADO == 2 ~ "Desocupados",
                                             ESTADO == 3 ~ "Inactivos",
                                             ESTADO == 4 ~ "Menor"), 
                          CAT_OCUP = case_when(CAT_OCUP == 1 ~ "Patrón",
                                               CAT_OCUP == 2 ~ "Cuenta propia",
                                               CAT_OCUP == 3 ~ "Empleado",
                                               CAT_OCUP == 4 ~ "Familiar",
                                               CAT_OCUP == 9 ~ "NS.NR"),
                          priv.pub = case_when(priv.pub == 1 ~ "Estatal",
                                               priv.pub == 2 ~ "Privado",
                                               priv.pub == 3 ~ "Otro")) %>% 
                    left_join(., provincias) %>%
                    left_join(., regiones) %>%  
                    left_join(.,Aglom) %>%
                    select(-AGLOMERADO)

Individual_t317 <- read.table("Base individual/USU_individual_t317.txt",
                                sep = ";",
                                dec = ",",
                                header = TRUE,
                                fill = TRUE ) %>% 
                   select(AGLOMERADO, PONDERA, ESTADO, CAT_OCUP, PP04A,
                          PP04B_COD) %>% 
                   rename(priv.pub = PP04A, codigo.actividad = PP04B_COD) %>% 
                   mutate(ESTADO = case_when(ESTADO == 0 ~ "Sin resp",
                                             ESTADO == 1 ~ "Ocupados",
                                             ESTADO == 2 ~ "Desocupados",
                                             ESTADO == 3 ~ "Inactivos",
                                             ESTADO == 4 ~ "Menor"), 
                          CAT_OCUP = case_when(CAT_OCUP == 1 ~ "Patrón",
                                               CAT_OCUP == 2 ~ "Cuenta propia",
                                               CAT_OCUP == 3 ~ "Empleado",
                                               CAT_OCUP == 4 ~ "Familiar",
                                               CAT_OCUP == 9 ~ "NS.NR"),
                          priv.pub = case_when(priv.pub == 1 ~ "Estatal",
                                               priv.pub == 2 ~ "Privado",
                                               priv.pub == 3 ~ "Otro")) %>% 
                    left_join(., provincias) %>%
                    left_join(., regiones) %>%  
                    left_join(.,Aglom) %>%
                    select(-AGLOMERADO)

Individual_t217 <- read.table("Base individual/USU_individual_t217.txt",
                                sep = ";",
                                dec = ",",
                                header = TRUE,
                                fill = TRUE ) %>% 
                   select(AGLOMERADO, PONDERA, ESTADO, CAT_OCUP, PP04A,
                          PP04B_COD) %>% 
                   rename(priv.pub = PP04A, codigo.actividad = PP04B_COD) %>% 
                   mutate(ESTADO = case_when(ESTADO == 0 ~ "Sin resp",
                                             ESTADO == 1 ~ "Ocupados",
                                             ESTADO == 2 ~ "Desocupados",
                                             ESTADO == 3 ~ "Inactivos",
                                             ESTADO == 4 ~ "Menor"), 
                          CAT_OCUP = case_when(CAT_OCUP == 1 ~ "Patrón",
                                               CAT_OCUP == 2 ~ "Cuenta propia",
                                               CAT_OCUP == 3 ~ "Empleado",
                                               CAT_OCUP == 4 ~ "Familiar",
                                               CAT_OCUP == 9 ~ "NS.NR"),
                          priv.pub = case_when(priv.pub == 1 ~ "Estatal",
                                               priv.pub == 2 ~ "Privado",
                                               priv.pub == 3 ~ "Otro")) %>% 
                    left_join(., provincias) %>%
                    left_join(., regiones) %>%  
                    left_join(.,Aglom) %>%
                    select(-AGLOMERADO)

Individual_t117 <- read.table("Base individual/USU_individual_t117.txt",
                                sep = ";",
                                dec = ",",
                                header = TRUE,
                                fill = TRUE ) %>% 
                   select(AGLOMERADO, PONDERA, ESTADO, CAT_OCUP, PP04A,
                          PP04B_COD) %>% 
                   rename(priv.pub = PP04A, codigo.actividad = PP04B_COD) %>% 
                   mutate(ESTADO = case_when(ESTADO == 0 ~ "Sin resp",
                                             ESTADO == 1 ~ "Ocupados",
                                             ESTADO == 2 ~ "Desocupados",
                                             ESTADO == 3 ~ "Inactivos",
                                             ESTADO == 4 ~ "Menor"), 
                          CAT_OCUP = case_when(CAT_OCUP == 1 ~ "Patrón",
                                               CAT_OCUP == 2 ~ "Cuenta propia",
                                               CAT_OCUP == 3 ~ "Empleado",
                                               CAT_OCUP == 4 ~ "Familiar",
                                               CAT_OCUP == 9 ~ "NS.NR"),
                          priv.pub = case_when(priv.pub == 1 ~ "Estatal",
                                               priv.pub == 2 ~ "Privado",
                                               priv.pub == 3 ~ "Otro")) %>% 
                    left_join(., provincias) %>%
                    left_join(., regiones) %>%  
                    left_join(.,Aglom) %>%
                    select(-AGLOMERADO)

Individual_t416 <- read.table("Base individual/USU_individual_t416.txt",
                                sep = ";",
                                dec = ",",
                                header = TRUE,
                                fill = TRUE ) %>% 
                   select(AGLOMERADO, PONDERA, ESTADO, CAT_OCUP, PP04A,
                          PP04B_COD) %>% 
                   rename(priv.pub = PP04A, codigo.actividad = PP04B_COD) %>% 
                   mutate(ESTADO = case_when(ESTADO == 0 ~ "Sin resp",
                                             ESTADO == 1 ~ "Ocupados",
                                             ESTADO == 2 ~ "Desocupados",
                                             ESTADO == 3 ~ "Inactivos",
                                             ESTADO == 4 ~ "Menor"), 
                          CAT_OCUP = case_when(CAT_OCUP == 1 ~ "Patrón",
                                               CAT_OCUP == 2 ~ "Cuenta propia",
                                               CAT_OCUP == 3 ~ "Empleado",
                                               CAT_OCUP == 4 ~ "Familiar",
                                               CAT_OCUP == 9 ~ "NS.NR"),
                          priv.pub = case_when(priv.pub == 1 ~ "Estatal",
                                               priv.pub == 2 ~ "Privado",
                                               priv.pub == 3 ~ "Otro")) %>% 
                    left_join(., provincias) %>%
                    left_join(., regiones) %>%  
                    left_join(.,Aglom) %>%
                    select(-AGLOMERADO)

Individual_t316 <- read.table("Base individual/USU_individual_t316.txt",
                                sep = ";",
                                dec = ",",
                                header = TRUE,
                                fill = TRUE ) %>% 
                   select(AGLOMERADO, PONDERA, ESTADO, CAT_OCUP, PP04A,
                          PP04B_COD) %>% 
                   rename(priv.pub = PP04A, codigo.actividad = PP04B_COD) %>% 
                   mutate(ESTADO = case_when(ESTADO == 0 ~ "Sin resp",
                                             ESTADO == 1 ~ "Ocupados",
                                             ESTADO == 2 ~ "Desocupados",
                                             ESTADO == 3 ~ "Inactivos",
                                             ESTADO == 4 ~ "Menor"), 
                          CAT_OCUP = case_when(CAT_OCUP == 1 ~ "Patrón",
                                               CAT_OCUP == 2 ~ "Cuenta propia",
                                               CAT_OCUP == 3 ~ "Empleado",
                                               CAT_OCUP == 4 ~ "Familiar",
                                               CAT_OCUP == 9 ~ "NS.NR"),
                          priv.pub = case_when(priv.pub == 1 ~ "Estatal",
                                               priv.pub == 2 ~ "Privado",
                                               priv.pub == 3 ~ "Otro")) %>% 
                    left_join(., provincias) %>%
                    left_join(., regiones) %>%  
                    left_join(.,Aglom) %>%
                    select(-AGLOMERADO)

Individual_t216 <- read.table("Base individual/USU_individual_t216.txt",
                                sep = ";",
                                dec = ",",
                                header = TRUE,
                                fill = TRUE ) %>% 
                   select(AGLOMERADO, PONDERA, ESTADO, CAT_OCUP, PP04A,
                          PP04B_COD) %>% 
                   rename(priv.pub = PP04A, codigo.actividad = PP04B_COD) %>% 
                   mutate(ESTADO = case_when(ESTADO == 0 ~ "Sin resp",
                                             ESTADO == 1 ~ "Ocupados",
                                             ESTADO == 2 ~ "Desocupados",
                                             ESTADO == 3 ~ "Inactivos",
                                             ESTADO == 4 ~ "Menor"), 
                          CAT_OCUP = case_when(CAT_OCUP == 1 ~ "Patrón",
                                               CAT_OCUP == 2 ~ "Cuenta propia",
                                               CAT_OCUP == 3 ~ "Empleado",
                                               CAT_OCUP == 4 ~ "Familiar",
                                               CAT_OCUP == 9 ~ "NS.NR"),
                          priv.pub = case_when(priv.pub == 1 ~ "Estatal",
                                               priv.pub == 2 ~ "Privado",
                                               priv.pub == 3 ~ "Otro")) %>% 
                    left_join(., provincias) %>%
                    left_join(., regiones) %>%  
                    left_join(.,Aglom) %>%
                    select(-AGLOMERADO)

```
## Cálculo de las tasas

```{r tasas EPH, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

####Tasas a nivel país

Tasas_t219 <- Individual_t219 %>% 
              summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2019 2T"), nrow(length(.)))) 

Tasas_t119 <- Individual_t119 %>% 
              summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2019 1T"), nrow(length(.))))               

Tasas_t418 <- Individual_t418 %>% 
              summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2018 4T"), nrow(length(.)))) 

Tasas_t318 <- Individual_t318 %>% 
              summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2018 3T"), nrow(length(.)))) 

Tasas_t218 <- Individual_t218 %>% 
              summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2018 2T"), nrow(length(.)))) 

Tasas_t118 <- Individual_t118 %>% 
              summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2018 1T"), nrow(length(.)))) 

Tasas_t417 <- Individual_t417 %>% 
              summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2017 4T"), nrow(length(.))))

Tasas_t317 <- Individual_t317 %>% 
              summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2017 3T"), nrow(length(.))))

Tasas_t217 <- Individual_t217 %>% 
              summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2017 2T"), nrow(length(.))))

Tasas_t117 <- Individual_t117 %>% 
              summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2017 1T"), nrow(length(.)))) 

Tasas_t416 <- Individual_t416 %>% 
              summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2016 4T"), nrow(length(.)))) 

Tasas_t316 <- Individual_t316 %>% 
              summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2016 3T"), nrow(length(.)))) 

Tasas_t216 <- Individual_t216 %>% 
              summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2016 2T"), nrow(length(.)))) 

Tasas <- rbind(Tasas_t219, Tasas_t119, Tasas_t418, Tasas_t318, Tasas_t218,
               Tasas_t118, Tasas_t417, Tasas_t317, Tasas_t217, Tasas_t117,
               Tasas_t416, Tasas_t316, Tasas_t216)

#### Tasas por aglomerado

Tasas_t219_aglo <- Individual_t219 %>%
                   group_by(Nom_Aglo) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2019 2T"), nrow(length(.))))    

Tasas_t119_aglo <- Individual_t119 %>%
                   group_by(Nom_Aglo) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2019 1T"), nrow(length(.)))) 

Tasas_t418_aglo <- Individual_t418 %>%
                   group_by(Nom_Aglo) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2018 4T"), nrow(length(.)))) 

Tasas_t318_aglo <- Individual_t318 %>%
                   group_by(Nom_Aglo) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2018 3T"), nrow(length(.)))) 

Tasas_t218_aglo <- Individual_t218 %>%
                   group_by(Nom_Aglo) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2018 2T"), nrow(length(.)))) 

Tasas_t118_aglo <- Individual_t118 %>%
                   group_by(Nom_Aglo) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2018 1T"), nrow(length(.)))) 

Tasas_t417_aglo <- Individual_t417 %>%
                   group_by(Nom_Aglo) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2017 4T"), nrow(length(.)))) 

Tasas_t317_aglo <- Individual_t317 %>%
                   group_by(Nom_Aglo) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2017 3T"), nrow(length(.)))) 

Tasas_t217_aglo <- Individual_t217 %>%
                   group_by(Nom_Aglo) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2017 2T"), nrow(length(.)))) 

Tasas_t117_aglo <- Individual_t117 %>%
                   group_by(Nom_Aglo) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2017 1T"), nrow(length(.)))) 

Tasas_t416_aglo <- Individual_t416 %>%
                   group_by(Nom_Aglo) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2016 4T"), nrow(length(.)))) 

Tasas_t316_aglo <- Individual_t316 %>%
                   group_by(Nom_Aglo) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2016 3T"), nrow(length(.)))) 

Tasas_t216_aglo <- Individual_t216 %>%
                   group_by(Nom_Aglo) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2016 2T"), nrow(length(.)))) 

Tasas_aglo <- rbind(Tasas_t219_aglo, Tasas_t119_aglo, Tasas_t418_aglo,
                    Tasas_t318_aglo, Tasas_t218_aglo, Tasas_t118_aglo,
                    Tasas_t417_aglo, Tasas_t317_aglo, Tasas_t217_aglo,
                    Tasas_t117_aglo, Tasas_t416_aglo, Tasas_t316_aglo,
                    Tasas_t216_aglo)

#### Tasas por provincia

Tasas_t219_prov <- Individual_t219 %>%
                   group_by(PROVINCIA) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2019 2T"), nrow(length(.)))) 

Tasas_t119_prov <- Individual_t119 %>%
                   group_by(PROVINCIA) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2019 1T"), nrow(length(.)))) 

Tasas_t418_prov <- Individual_t418 %>%
                   group_by(PROVINCIA) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2018 4T"), nrow(length(.)))) 

Tasas_t318_prov <- Individual_t318 %>%
                   group_by(PROVINCIA) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2018 3T"), nrow(length(.)))) 

Tasas_t218_prov <- Individual_t218 %>%
                   group_by(PROVINCIA) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2018 2T"), nrow(length(.)))) 

Tasas_t118_prov <- Individual_t118 %>%
                   group_by(PROVINCIA) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2018 1T"), nrow(length(.)))) 

Tasas_t417_prov <- Individual_t417 %>%
                   group_by(PROVINCIA) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2017 4T"), nrow(length(.)))) 

Tasas_t317_prov <- Individual_t317 %>%
                   group_by(PROVINCIA) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2017 3T"), nrow(length(.)))) 

Tasas_t217_prov <- Individual_t217 %>%
                   group_by(PROVINCIA) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2017 2T"), nrow(length(.)))) 

Tasas_t117_prov <- Individual_t117 %>%
                   group_by(PROVINCIA) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2017 1T"), nrow(length(.)))) 

Tasas_t416_prov <- Individual_t416 %>%
                   group_by(PROVINCIA) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2016 4T"), nrow(length(.))))

Tasas_t316_prov <- Individual_t316 %>%
                   group_by(PROVINCIA) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2016 3T"), nrow(length(.)))) 

Tasas_t216_prov <- Individual_t216 %>%
                   group_by(PROVINCIA) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2016 2T"), nrow(length(.)))) 

Tasas_prov <- rbind(Tasas_t219_prov, Tasas_t119_prov, Tasas_t418_prov,
                    Tasas_t318_prov, Tasas_t218_prov, Tasas_t118_prov,
                    Tasas_t417_prov, Tasas_t317_prov, Tasas_t217_prov,
                    Tasas_t117_prov, Tasas_t416_prov, Tasas_t316_prov,
                    Tasas_t216_prov)

#### Tasas por región

Tasas_t219_reg <- Individual_t219 %>%
                   group_by(REGION) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2019 2T"), nrow(length(.)))) 

Tasas_t119_reg <- Individual_t119 %>%
                   group_by(REGION) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2019 1T"), nrow(length(.)))) 

Tasas_t418_reg <- Individual_t418 %>%
                   group_by(REGION) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2018 4T"), nrow(length(.)))) 

Tasas_t318_reg <- Individual_t318 %>%
                   group_by(REGION) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2018 3T"), nrow(length(.)))) 

Tasas_t218_reg <- Individual_t218 %>%
                   group_by(REGION) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2018 2T"), nrow(length(.))))

Tasas_t118_reg <- Individual_t118 %>%
                   group_by(REGION) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2018 1T"), nrow(length(.)))) 

Tasas_t417_reg <- Individual_t417 %>%
                   group_by(REGION) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2017 4T"), nrow(length(.))))

Tasas_t317_reg <- Individual_t317 %>%
                   group_by(REGION) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2017 3T"), nrow(length(.)))) 

Tasas_t217_reg <- Individual_t217 %>%
                   group_by(REGION) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2017 2T"), nrow(length(.)))) 

Tasas_t117_reg <- Individual_t117 %>%
                   group_by(REGION) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2017 1T"), nrow(length(.)))) 

Tasas_t416_reg <- Individual_t416 %>%
                   group_by(REGION) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2016 4T"), nrow(length(.)))) 

Tasas_t316_reg <- Individual_t316 %>%
                   group_by(REGION) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2016 3T"), nrow(length(.)))) 

Tasas_t216_reg <- Individual_t216 %>%
                   group_by(REGION) %>%   
                   summarise(Poblacion = sum(PONDERA),
                        Ocupados = sum(PONDERA[ESTADO == "Ocupados"]),
                        Desocupados = sum(PONDERA[ESTADO == "Desocupados"]),
                        PEA = Ocupados + Desocupados,
                        'Tasa Actividad' = formato_porc(PEA/Poblacion*100),
                        'Tasa Empleo' = formato_porc(Ocupados/Poblacion*100),
                        'Tasa Desocupacion' = formato_porc(Desocupados/PEA*100)) %>% 
                   cbind(Periodo = c(rep("2016 2T"), nrow(length(.)))) 


Tasas_reg <- rbind(Tasas_t219_reg, Tasas_t119_reg, Tasas_t418_reg,
                   Tasas_t318_reg, Tasas_t218_reg, Tasas_t118_reg,
                   Tasas_t417_reg, Tasas_t317_reg, Tasas_t217_reg,
                   Tasas_t117_reg, Tasas_t416_reg, Tasas_t316_reg,
                   Tasas_t216_reg)

  
```
## Armado del tablero
```{r tasas EPH, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
#library(tidyverse)
library(shiny)
library(ggplot2)
library(dplyr)
library(sf)
library(hrbrthemes)
library(treemap)
library(lubridate)
library(formattable)
library(plm)
library(httr)
library(janitor)
library(plotly)
library(highcharter)
library(shinyWidgets)

ui <- fluidPage(
    titlePanel(h1("Tablero EPH", style = "color:#0991d1")),

    tabsetPanel(type = "tabs",
                tabPanel("Argentina",
                         sidebarLayout(
                           sidebarPanel(
                             selectInput(inputId = "argentinaInput",
                                         label = "Seleccionar periodo:",
                                         choices = levels(Tasas$Periodo),
                                         selected = levels(Tasas$Periodo)[1])),
                           
                                mainPanel(
                                 tabsetPanel(type = "tabs",
                                   tabPanel("Tasas",
                                    h3("Tasa de actividad", style = "color:#0991d1"),
                                      h5("Población Económicamente Activa (PEA)/Población Total"),
                                      formattableOutput("table_tasa_actividad"),
                                      br(), br(),
                                    h3("Tasa de emplo", style = "color:#0991d1"),
                                      h5("Ocupados/Población Total"),
                                      formattableOutput("table_tasa_empleo"),
                                      br(), br(),
                                    h3("Tasa de desocupación", style = "color:#0991d1"),
                                      h5("Desocupados/Población Económicamente Activa (PEA)"),
                                      formattableOutput("table_tasa_desocupados"),
                                      br(), br()),

                                  tabPanel("Gráficos",
                                    h3("Tasa de actividad"),
                                      h5("2T de 2016 a 2T de 2019"),
                                      plotlyOutput("bars_actividad"),
                                      br(), br(),
                                    h3("Tasa de empleo"),
                                      h5("2T de 2016 a 2T de 2019"),
                                      plotlyOutput("bars_empleo"),
                                      br(), br(),
                                    h3("Tasa de desocupación"),
                                      h5("2T de 2016 a 2T de 2019"),
                                      plotlyOutput("bars_desocupación"),
                                      br(), br()),
                                    
                                  tabPanel("Tabla",
                                    h3("Principales tasas"),
                                      h5("2T de 2016 a 2T de 2019"),
                                      dataTableOutput("table_tasas")))))),
                
                tabPanel("Regiones",
                         sidebarLayout(
                           sidebarPanel(
                             selectInput(inputId = "tasaregionesInput",
                                         label = "Seleccionar tasa:",
                                         choices = c("Tasa de actividad", 
                                                     "Tasa de empleo", 
                                                     "Tasa de desocupación"), 
                                         selected = "Tasa de actividad"),
                             
                             selectInput(inputId = "periodoInput",
                                         label = "Seleccionar periodo:",
                                         choices = levels(Tasas$Periodo),
                                         selected = levels(Tasas$Periodo)[1])),
                           
                                mainPanel(
                                  h3("Tasa seleccionada", 
                                     style = "color:#0991d1"),
                                  plotlyOutput("mapa_tasa_reg"),
                                  br(), br(),
                                    h5("Tasa seleccionada por región", 
                                     style = "color:#0991d1"),
                                    plotlyOutput("tabla_tasa_reg")))),
                
                tabPanel("Provincias",
                         sidebarLayout(
                           sidebarPanel(
                             selectInput(inputId = "tasaprovinciasInput",
                                         label = "Seleccionar tasa:",
                                         choices = c("Tasa de actividad", 
                                                     "Tasa de empleo", 
                                                     "Tasa de desocupación"), 
                                         selected = "Tasa de actividad"),
                             
                             selectInput(inputId = "periodoInput",
                                         label = "Seleccionar periodo:",
                                         choices = levels(Tasas$Periodo),
                                         selected = levels(Tasas$Periodo)[1])),
                           
                                mainPanel(
                                  h3("Tasa seleccionada", 
                                     style = "color:#0991d1"),
                                  plotlyOutput("mapa_tasa_prov"),
                                  br(), br(),
                                    h5("Tasa seleccionada por provincia", 
                                     style = "color:#0991d1"),
                                    plotlyOutput("tabla_tasa_prov")))),
    
                tabPanel("Aglomerados",
                         sidebarLayout(
                           sidebarPanel(
                             selectInput(inputId = "tasaaglomeradosInput",
                                         label = "Seleccionar tasa:",
                                         choices = c("Tasa de actividad", 
                                                     "Tasa de empleo", 
                                                     "Tasa de desocupación"), 
                                         selected = "Tasa de actividad"),
                             
                             selectInput(inputId = "periodoInput",
                                         label = "Seleccionar periodo:",
                                         choices = levels(Tasas$Periodo),
                                         selected = levels(Tasas$Periodo)[1])),
                           
                                mainPanel(
                                  h3("Tasa seleccionada", 
                                     style = "color:#0991d1"),
                                  plotlyOutput("mapa_tasa_aglo"),
                                  br(), br(),
                                    h5("Tasa seleccionada por aglomerado", 
                                     style = "color:#0991d1"),
                                    plotlyOutput("tabla_tasa_aglo"))))
    
  ))
  
###Falta armar el server, lo que contiene las tablas, gráficos, mapas, etc...                                
  server <- function(input, output) {}  
  shinyApp(ui, server)
```

